<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>Redeem Codes | EduQuest</title>
    <style>
        body { font-family: sans-serif; background: #f4f7f6; text-align: center; padding: 50px; }
        .box { max-width: 400px; margin: auto; background: white; padding: 30px; border-radius: 15px; box-shadow: 0 5px 15px rgba(0,0,0,0.1); }
        input { width: 80%; padding: 12px; margin: 10px 0; border: 2px solid #ddd; border-radius: 8px; }
        button { background: #2ecc71; color: white; border: none; padding: 12px 25px; border-radius: 8px; cursor: pointer; font-weight: bold; }
        .list { text-align: left; margin-top: 20px; color: #555; }
    </style>
</head>
<body>
    <div class="box">
        <h1>ğŸ”‘ Redeem Code</h1>
        <input type="text" id="code-input" placeholder="Enter secret code...">
        <button onclick="redeem()">Redeem Now</button>
        <div class="list" id="my-codes">
            <h4>Your Collection:</h4>
            <ul id="code-list"></ul>
        </div>
        <br><a href="index.html">Back to Game</a>
    </div>

    <script src="https://www.gstatic.com/firebasejs/9.0.0/firebase-app-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/9.0.0/firebase-auth-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/9.0.0/firebase-firestore-compat.js"></script>
    <script>
        const firebaseConfig = { /* PASTE YOUR KEYS HERE */ };
        firebase.initializeApp(firebaseConfig);
        const db = firebase.firestore();
        const auth = firebase.auth();

        async function redeem() {
            const code = document.getElementById('code-input').value.trim().toUpperCase();
            const user = auth.currentUser;
            if(!user) return alert("Please login first");

            // Verify if the code is valid (Starts with QUEST-)
            if(code.startsWith("QUEST-")) {
                await db.collection("users").doc(user.uid).update({
                    unlockedCodes: firebase.firestore.FieldValue.arrayUnion(code)
                });
                alert("Code Redeemed!");
                location.reload();
            } else { alert("Invalid Code Format!"); }
        }

        auth.onAuthStateChanged(user => {
            if(user) {
                db.collection("users").doc(user.uid).onSnapshot(doc => {
                    const codes = doc.data().unlockedCodes || [];
                    const list = document.getElementById('code-list');
                    list.innerHTML = codes.map(c => `<li>â­ ${c}</li>`).join('');
                });
            }
        });
    </script>
    <div class="navbar">
    <div class="nav-logo">ğŸš€ EduQuest</div>
    <div class="nav-right">
        <button onclick="location.href='leaderboard.html'">ğŸ† Leaderboard</button>
        <button onclick="location.href='codes.html'">ğŸ”‘ Codes</button>
        <span class="settings-gear" onclick="location.href='settings.html'">âš™ï¸</span>
    </div>
</div>
</body>
</html>