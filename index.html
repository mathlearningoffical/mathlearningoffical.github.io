<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>EduQuest | Learn & Unlock</title>
    <style>
        :root { --primary: #4a90e2; --secondary: #2ecc71; --dark: #2c3e50; --light: #ecf0f1; }
        body { font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif; background: var(--light); color: var(--dark); margin: 0; padding: 20px; text-align: center; }
        .container { max-width: 600px; margin: auto; background: white; padding: 30px; border-radius: 15px; box-shadow: 0 10px 25px rgba(0,0,0,0.1); }
        .hidden { display: none; }
        input { width: 80%; padding: 10px; margin: 10px 0; border: 2px solid #ddd; border-radius: 5px; }
        button { background: var(--primary); color: white; border: none; padding: 12px 25px; border-radius: 5px; cursor: pointer; font-weight: bold; transition: 0.3s; }
        button:hover { opacity: 0.8; transform: translateY(-2px); }
        .reward-box { background: #fff3cd; border: 2px dashed #ffeeba; padding: 15px; margin-top: 20px; border-radius: 10px; }
        .vault-list { text-align: left; background: #f9f9f9; padding: 15px; border-radius: 10px; }
        nav { margin-bottom: 20px; }
        .grade-badge { background: var(--secondary); color: white; padding: 5px 10px; border-radius: 20px; font-size: 0.8em; }
    </style>
</head>
<body>

    <div class="container">
        <h1>ðŸš€ EduQuest</h1>
        
        <div id="auth-section">
            <h3>Login or Create Account</h3>
            <input type="email" id="auth-email" placeholder="Email Address">
            <input type="password" id="auth-password" placeholder="Password">
            <div style="margin-top: 10px;">
                <button onclick="handleAuth('login')">Login</button>
                <button onclick="handleAuth('signup')" style="background: var(--secondary);">Create Account</button>
            </div>
        </div>

        <div id="game-section" class="hidden">
            <div id="user-info">
                <p>Welcome, <strong id="display-email"></strong>! <button onclick="logout()" style="padding: 5px 10px; background: #e74c3c;">Logout</button></p>
            </div>

            <hr>

            <h3>Pick a Grade Quiz</h3>
            <select id="grade-selector" onchange="loadQuiz()">
                <option value="">-- Choose Grade --</option>
                <option value="1">Grade 1 (Math)</option>
                <option value="5">Grade 5 (Science)</option>
                <option value="12">Grade 12 (Physics)</option>
            </select>

            <div id="quiz-container" class="hidden">
                <p id="question-text"></p>
                <input type="text" id="quiz-answer" placeholder="Your answer...">
                <button onclick="checkQuiz()">Submit Answer</button>
                <div id="quiz-reward" class="reward-box hidden">
                    ðŸŽ‰ Correct! Your code is: <strong id="earned-code"></strong>
                </div>
            </div>

            <hr>

            <h3>Redeem a Code</h3>
            <input type="text" id="redeem-input" placeholder="Enter code here...">
            <button onclick="redeemCode()">Add to Vault</button>

            <h3>Your Unlocked Vault</h3>
            <div class="vault-list" id="vault-list">
                <i>No codes found yet. Beat some quizzes!</i>
            </div>
        </div>
    </div>

    <script src="https://www.gstatic.com/firebasejs/9.0.0/firebase-app-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/9.0.0/firebase-auth-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/9.0.0/firebase-firestore-compat.js"></script>

    <script>
        // --- 1. CONFIGURATION (REPLACE WITH YOUR KEYS) ---
        const firebaseConfig = {
  apiKey: "AIzaSyDPk1zIZRAtOmHcyAIEZErl9JNSkXQPBv8",
  authDomain: "backend-2870f.firebaseapp.com",
  databaseURL: "https://backend-2870f-default-rtdb.firebaseio.com",
  projectId: "backend-2870f",
  storageBucket: "backend-2870f.firebasestorage.app",
  messagingSenderId: "103357825196",
  appId: "1:103357825196:web:1645af7ca7f95339835f09"
};
        };
        firebase.initializeApp(firebaseConfig);
        const auth = firebase.auth();
        const db = firebase.firestore();

        // --- 2. QUIZ DATA (Grades 1-12) ---
        const quizzes = {
            "1": { q: "What is 5 + 3?", a: "8", code: "G1-MATH-88" },
            "5": { q: "Which planet is known as the Red Planet?", a: "Mars", code: "G5-SPACE-X" },
            "12": { q: "What is the unit of Force?", a: "Newton", code: "G12-PHYS-N" }
            // Add more grades here following the same pattern!
        };

        // --- 3. AUTH LOGIC ---
        async function handleAuth(type) {
            const email = document.getElementById('auth-email').value;
            const password = document.getElementById('auth-password').value;
            try {
                if (type === 'signup') {
                    const cred = await auth.createUserWithEmailAndPassword(email, password);
                    await db.collection("users").doc(cred.user.uid).set({ unlockedCodes: [] });
                    alert("Account Created!");
                } else {
                    await auth.signInWithEmailAndPassword(email, password);
                }
            } catch (err) { alert(err.message); }
        }

        function logout() { auth.signOut(); location.reload(); }

        // --- 4. GAME & DATABASE LOGIC ---
        auth.onAuthStateChanged(user => {
            if (user) {
                document.getElementById('auth-section').classList.add('hidden');
                document.getElementById('game-section').classList.remove('hidden');
                document.getElementById('display-email').innerText = user.email;
                listenToVault(user.uid);
            }
        });

        function loadQuiz() {
            const grade = document.getElementById('grade-selector').value;
            if (!grade) return;
            document.getElementById('quiz-container').classList.remove('hidden');
            document.getElementById('question-text').innerText = quizzes[grade].q;
            document.getElementById('quiz-reward').classList.add('hidden');
            document.getElementById('quiz-answer').value = "";
        }

        function checkQuiz() {
            const grade = document.getElementById('grade-selector').value;
            const userAns = document.getElementById('quiz-answer').value.trim().toLowerCase();
            const realAns = quizzes[grade].a.toLowerCase();

            if (userAns === realAns) {
                document.getElementById('quiz-reward').classList.remove('hidden');
                document.getElementById('earned-code').innerText = quizzes[grade].code;
            } else {
                alert("Wrong answer! Try again.");
            }
        }

        async function redeemCode() {
            const code = document.getElementById('redeem-input').value.toUpperCase();
            const user = auth.currentUser;
            if (!code) return;

            // Check if code is valid (exists in our quiz data)
            const allCodes = Object.values(quizzes).map(item => item.code);
            if (allCodes.includes(code)) {
                await db.collection("users").doc(user.uid).update({
                    unlockedCodes: firebase.firestore.FieldValue.arrayUnion(code)
                });
                document.getElementById('redeem-input').value = "";
                alert("Code Redeemed!");
            } else {
                alert("Invalid Code!");
            }
        }

        function listenToVault(uid) {
            db.collection("users").doc(uid).onSnapshot(doc => {
                const codes = doc.data().unlockedCodes;
                const list = document.getElementById('vault-list');
                list.innerHTML = codes.length ? "" : "<i>No codes found yet.</i>";
                codes.forEach(c => {
                    list.innerHTML += `<div>âœ… Code: <strong>${c}</strong></div>`;
                });
            });
        }
    </script>
</body>
</html>